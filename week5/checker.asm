// save current value in KBD to compare, if it's the same as before then goto end
@savekey
M=0
(saisyo)
@SCREEN
D=A
@nextpixel
M=D
@257
D=A
@linenumber
M=D
@KBD
D=M
@savekey
D=D-M
@end
D;JEQ
@KBD
D=M
@savekey
M=D
@67
D=D-A
@branch
D;JEQ
@end
0;JMP

// use parity to decide which branch to go (odd or even)
(branch)
@parity
M=M+1
D=M
@1
D=D&A
@start
D;JGT
@startc
0;JMP

(start)
@linenumber
M=M-1
D=M
@end
D;JEQ
@1
D=D&A
@pattern2
D;JGT
@pattern1
0;JMP

(pattern1)
@32
D=A
@toprint
M=D
(printline1)
@toprint
M=M-1
D=M
@start
D;JLT
@21845
D=A
@nextpixel
A=M
M=D
@nextpixel
M=M+1
@printline1
0;JMP

(pattern2)
@32
D=A
@toprint
M=D
(printline2)
@toprint
M=M-1
D=M
@start
D;JLT
@21846
D=-A
@nextpixel
A=M
M=D
@nextpixel
M=M+1
@printline2
0;JMP

(branchc)
(startc)
@linenumber
M=M-1
D=M
@end
D;JEQ
@1
D=D&A
@pattern2c
D;JGT
@pattern1c
0;JMP

(pattern1c)
@32
D=A
@toprint
M=D
(printline1c)
@toprint
M=M-1
D=M
@startc
D;JLT
@21846
D=-A
@nextpixel
A=M
M=D
@nextpixel
M=M+1
@printline1c
0;JMP

(pattern2c)
@32
D=A
@toprint
M=D
(printline2c)
@toprint
M=M-1
D=M
@startc
D;JLT
@21845
D=A
@nextpixel
A=M
M=D
@nextpixel
M=M+1
@printline2c
0;JMP

(end)
@saisyo
0;JMP
